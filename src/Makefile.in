CC=@CC@
SWIG=@SWIG@
PYDEV=@PYDEV@
PYLIB=@PYLIB@
LDFLAGS=@LDFLAGS@
CFLAGS=@CFLAGS@
prefix=@prefix@
exec_prefix=@exec_prefix@
LIBDIR=@libdir@
INCDIR=@includedir@
INC=-I$(PYDEV)
TARGET=mpsse

all: $(TARGET) swig

$(TARGET): mpsse.o
	gcc -shared -Wl,-soname,lib$(TARGET).so $(TARGET).o support.o -o lib$(TARGET).so $(LDFLAGS)
	ar rcs lib$(TARGET).a $(TARGET).o support.o

examples: spitest i2ctest

spitest:
	$(CC) $(CFLAGS) examples/spitest.c -o examples/spitest -lmpsse

i2ctest:
	$(CC) $(CFLAGS) examples/i2ctest.c -o examples/i2ctest -lmpsse

mpsse.o: support.o
	$(CC) $(CFLAGS) $(LDFLAGS) -c mpsse.c

support.o:
	$(CC) $(CFLAGS) $(LDFLAGS) -c support.c

swig:
	$(CC) $(CFLAGS) $(LDFLAGS) -DSWIGPYTHON -c support.c
	$(CC) $(CFLAGS) $(LDFLAGS) -DSWIGPYTHON -c mpsse.c
	$(SWIG) -python $(TARGET).i
	$(CC) -c  $(TARGET)_wrap.c  $(INC)
	ld -shared $(TARGET)_wrap.o mpsse.o support.o -o _$(TARGET).so $(LDFLAGS) $(INC)

install:
	cp lib$(TARGET).so $(LIBDIR)/lib$(TARGET).so
	cp lib$(TARGET).a $(LIBDIR)/lib$(TARGET).a
	cp $(TARGET).py $(PYLIB)/$(TARGET).py
	cp _$(TARGET).so $(PYLIB)/_$(TARGET).so
	cp $(TARGET).h $(INCDIR)/$(TARGET).h

uninstall:
	rm -f $(LIBDIR)/lib$(TARGET).so $(LIBDIR)/lib$(TARGET).a
	rm -f $(PYLIB)/$(TARGET).* $(PYLIB)/_$(TARGET).so
	rm -f $(INCDIR)/$(TARGET).h

clean:
	rm -f examples/spitest examples/i2ctest *.o *.so *.a $(TARGET).py* $(TARGET)_wrap.c

cleanall: clean
	rm -rf *.cache config.* Makefile

