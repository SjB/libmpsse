CC=@CC@
SWIG=@SWIG@
PYDEV=@PYDEV@
PYLIB=@PYLIB@
LDFLAGS=@LDFLAGS@
CFLAGS=@CFLAGS@
prefix=@prefix@
exec_prefix=@exec_prefix@
LIBDIR=@libdir@
INC=-I$(PYDEV)
TARGET=mpsse

all: $(TARGET) swig

$(TARGET): mpsse.o
	gcc -shared -Wl,-soname,lib$(TARGET).so $(TARGET).o support.o -o lib$(TARGET).so $(LDFLAGS)

examples: spitest i2ctest

spitest:
	$(CC) $(CFLAGS) $(LDFLAGS) spitest.c -o spitest -lmpsse

i2ctest:
	$(CC) $(CFLAGS) $(LDFLAGS) i2ctest.c -o i2ctest -lmpsse

mpsse.o: support.o
	$(CC) $(CFLAGS) $(LDFLAGS) -c mpsse.c

support.o:
	$(CC) $(CFLAGS) $(LDFLAGS) -c support.c

swig:
	$(CC) $(CFLAGS) $(LDFLAGS) -DSWIGPYTHON -c support.c
	$(CC) $(CFLAGS) $(LDFLAGS) -DSWIGPYTHON -c mpsse.c
	$(SWIG) -python $(TARGET).i
	$(CC) $(CFLAGS) -c  $(TARGET)_wrap.c $(LDFLAGS) $(INC)
	ld -shared $(TARGET)_wrap.o mpsse.o support.o -o _$(TARGET).so $(LDFLAGS) $(INC)

install:
	cp lib$(TARGET).so $(LIBDIR)/lib$(TARGET).so
	cp $(TARGET).py $(PYLIB)/$(TARGET).py
	cp _$(TARGET).so $(PYLIB)/_$(TARGET).so

uninstall:
	rm -f $(LIBDIR)/lib$(TARGET).so
	rm -f $(PYLIB)/$(TARGET).py $(PYLIB)/_$(TARGET).so

clean:
	rm -f spitest i2ctest *.o *.so $(TARGET).py* $(TARGET)_wrap.c

cleanall: clean
	rm -rf *.cache config.* Makefile

